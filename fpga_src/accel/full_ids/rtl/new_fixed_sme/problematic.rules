alert tcp $EXTERNAL_NET $FILE_DATA_PORTS -> $HOME_NET any ( msg:"FILE-MULTIMEDIA Adobe Flash Player ID3 tag integer overflow attempt"; flow:to_client,established; file_data; content:"ID3|03 00|",depth 5,nocase; byte_test:1,&,0x80,14,relative; byte_test:4,>,0x2aaaaaaa,15,relative; pcre:"/ID3\x03\x00.{5}([TW][A-Z]{3}|COMM)/smi"; metadata:policy balanced-ips drop,policy max-detect-ips drop,policy security-ips drop; service:ftp-data, http, imap, pop3; reference:bugtraq,76289; reference:cve,2015-5560; reference:url,helpx.adobe.com/security/products/flash-player/apsb15-19.html; classtype:attempted-user; sid:36113; rev:3; )
alert tcp $EXTERNAL_NET any -> $SMTP_SERVERS 25 ( msg:"FILE-MULTIMEDIA Adobe Flash Player ID3 tag integer overflow attempt"; flow:to_server,established; file_data; content:"ID3|03 00|",depth 5,nocase; byte_test:1,&,0x80,14,relative; byte_test:4,>,0x2aaaaaaa,15,relative; pcre:"/ID3\x03\x00.{5}([TW][A-Z]{3}|COMM)/smi"; metadata:policy balanced-ips drop,policy max-detect-ips drop,policy security-ips drop; service:smtp; reference:bugtraq,76289; reference:cve,2015-5560; reference:url,helpx.adobe.com/security/products/flash-player/apsb15-19.html; classtype:attempted-user; sid:36114; rev:3; )
alert udp $HOME_NET any -> $EXTERNAL_NET 53 ( msg:"MALWARE-CNC Win.Trojan.QUADAGENT outbound DNS tunnel"; flow:to_server,no_stream; content:"|01 00|",depth 2,offset 2; content:"|04|mail|06|",within 6,distance 8; byte_test:6,>=,100000,0,relative,string,dec; byte_test:6,<=,999999,0,relative,string,dec; pcre:"/\x04mail\x06\d{6}.*\x00\x1c.{2}$/"; metadata:impact_flag red,policy balanced-ips drop,policy max-detect-ips drop,policy security-ips drop; service:dns; reference:url,virustotal.com/gui/file/1f6369b42a76d02f32558912b57ede4f5ff0a90b18d3b96a4fe24120fa2c300c; classtype:trojan-activity; sid:50769; rev:2; )
alert tcp $EXTERNAL_NET any -> $HOME_NET 6780 ( msg:"SERVER-OTHER Siemens Desigo Insight buffer overflow attempt "; flow:to_server,established; isdataat:31; isdataat:!32; content:"|0D 03 00 00|",depth 4; content:"|81|",within 1,distance 3; byte_test:4,>,0x100,0,relative; pcre:"/^.{12}[^\x00\x40\xff]{20}$/"; metadata:policy balanced-ips drop,policy connectivity-ips drop,policy max-detect-ips drop,policy security-ips drop,ruleset limited; reference:url,www.buildingtechnologies.siemens.com/bt/global/en/buildingautomation-hvac/buildingautomation/building-automation-and-control-system-europe-desigo/management-station/pages/managementstation.aspx; classtype:attempted-admin; sid:35909; rev:5; )
alert tcp any any -> $HOME_NET 445 ( msg:"OS-WINDOWS Microsoft Windows SMBv1 identical MID and FID type confusion attempt"; flow:to_server,established; content:"|FF|SMB|2F 00 00 00 00|",depth 9,offset 4,fast_pattern; byte_test:1,!&,0x80,0,relative; content:"|00 00 00 00 00 00 00 00 00 00|",within 10,distance 5; byte_extract:2,6,mid,relative,little; content:"|FF 00|",within 2,distance 1; byte_test:2,=,mid,2,relative,little; content:"|04 00|",within 2,distance 12; byte_test:2,>,65000,0,relative,little; byte_test:2,>,500,4,relative,little; metadata:policy balanced-ips drop,policy max-detect-ips drop,policy security-ips drop; service:netbios-ssn; reference:cve,2017-0143; reference:url,technet.microsoft.com/en-us/security/bulletin/MS17-010; classtype:attempted-admin; sid:41984; rev:5; )
